"use strict";var map,restaurant=void 0,key=config.googleMapApi;function fetchRestaurantsAll(e){return e}function fetchUniqueRestaurant(e){var t=e,n=getParameterByName("id");if(n)return t=t.filter(function(e){return e.id==n}),restaurant=t[0]}if(window.initMap=function(){if(navigator.serviceWorker){idb.open("mwsStage2",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("mwsData",{keyPath:"id"})}}).then(function(e){return e.transaction("mwsData","readonly").objectStore("mwsData").getAll()}).then(fetchUniqueRestaurant).then(e).catch(function(e){return console.error(e)})}else fetch(DBHelper.DATABASE_URL,{}).then(function(e){return e.json()}).then(fetchRestaurantsAll).then(fetchUniqueRestaurant).then(e).catch(function(e){return console.error(e)});function e(e){self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:e.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)}},navigator.serviceWorker){var getRestaurant=function(){dbPromise.then(function(e){return e.transaction("mwsData","readonly").objectStore("mwsData").getAll()}).then(fetchUniqueRestaurant).then(fetchUniqueRestHTML).catch(function(e){return console.error(e)})},dbPromise=idb.open("mwsStage2",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("mwsData",{keyPath:"id"})}});getRestaurant()}else fetch(DBHelper.DATABASE_URL,{}).then(function(e){return e.json()}).then(fetchRestaurantsAll).then(fetchUniqueRestaurant).then(fetchUniqueRestHTML).catch(function(e){return console.error(e)});function fetchUniqueRestHTML(e){self.restaurant=e,fillRestaurantHTML()}var fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.setAttribute("alt","promotional photo for "+e.name),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li");t.setAttribute("class","reviewListing");var n=document.createElement("p");n.innerHTML=e.name,n.setAttribute("class","reviewName"),t.appendChild(n);var r=document.createElement("p");r.innerHTML=e.date,r.setAttribute("class","reviewDate"),t.appendChild(r);var a=document.createElement("p");a.innerHTML="Rating: "+e.rating,a.setAttribute("class","reviewRating"),t.appendChild(a);var i=document.createElement("p");return i.innerHTML=e.comments,i.setAttribute("class","reviewComments"),t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};function addApiKey(){if(""==key)var e="";else e="key="+config.googleMapApi+"&";document.getElementById("googleApi").setAttribute("src","https://maps.googleapis.com/maps/api/js?"+e+"libraries=places&callback=initMap")}document.addEventListener("DOMContentLoaded",function(){console.log("ready!"),addApiKey()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJtYXAiLCJyZXN0YXVyYW50IiwiY29uZmlnIiwiZ29vZ2xlTWFwQXBpIiwia2V5IiwiZGF0YSIsImZldGNoVW5pcXVlUmVzdGF1cmFudCIsInJlc3VsdHMiLCJyZXN0YXVyYW50cyIsImdldFBhcmFtZXRlckJ5TmFtZSIsInIiLCJpZCIsIndpbmRvdyIsImluaXRNYXAiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsIm9sZFZlcnNpb24iLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJjb25zb2xlIiwiZXJyb3IiLCJvYmplY3RTdG9yZSIsImdldEFsbCIsInRoZW4iLCJmZXRjaFJlc3RhdXJhbnRNYXAiLCJjYXRjaCIsImZldGNoIiwiREJIZWxwZXIiLCJEQVRBQkFTRV9VUkwiLCJyZXNwb25zZSIsImpzb24iLCJmZXRjaFJlc3RhdXJhbnRzQWxsIiwic2VsZiIsImdvb2dsZSIsIm1hcHMiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsInNjcm9sbHdoZWVsIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImdldFJlc3RhdXJhbnQiLCJkYlByb21pc2UiLCJkYiIsInRyYW5zYWN0aW9uIiwiZmV0Y2hVbmlxdWVSZXN0SFRNTCIsImZpbGxSZXN0YXVyYW50SFRNTCIsIm5hbWUiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJpbm5lckhUTUwiLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJzZXRBdHRyaWJ1dGUiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJjdWlzaW5lX3R5cGUiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwib3BlcmF0aW5nX2hvdXJzIiwiaG91cnMiLCJyb3ciLCJkYXkiLCJjcmVhdGVFbGVtZW50IiwidGltZSIsImFwcGVuZENoaWxkIiwicmV2aWV3cyIsInRpdGxlIiwiY29udGFpbmVyIiwibm9SZXZpZXdzIiwiZm9yRWFjaCIsInJldmlldyIsInVsIiwiY3JlYXRlUmV2aWV3SFRNTCIsImxpIiwiZGF0ZSIsInJhdGluZyIsImNvbW1lbnRzIiwiZmlsbEJyZWFkY3J1bWIiLCJicmVhZGNydW1iIiwidXJsIiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsIlJlZ0V4cCIsInJlZ2V4IiwiYWRkQXBpS2V5IiwiYXBpS2V5IiwicGF0aEVuZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJsb2ciXSwibWFwcGluZ3MiOiJhQUFBLElBQ0lBLElBREFDLGdCQUFBQSxFQUNBRCxJQUFKRSxPQUFBQyxhQUVBLFNBQUlDLG9CQUFKQyxHQUdFLE9BQU9BLEVBQ1IsU0FBQUMsc0JBQUFELEdBR0MsSUFERkUsRUFDc0JGLEVBQWRHLEVBQUFBLG1CQUFOLE1BQ0EsR0FBSUQsRUFHRkEsT0FGRkEsRUFBV0UsRUFBQUEsT0FBQUEsU0FBQUEsR0FBQUEsT0FBQUMsRUFBWEMsSUFBQUEsSUFDQVYsV0FBUU0sRUFBQSxHQXlFVixHQTdEQUssT0FBT0MsUUFBVSxXQUdmLEdBQUlDLFVBQVVDLGNBQWUsQ0FIZEMsSUFBQUMsS0FBTSxZQUFBLEVBQUEsU0FBQUMsR0FFckIsT0FBQUEsRUFBQUMsWUFDSUwsS0FBVUMsRUFVWkcsRUFBQUUsa0JBQUEsVUFBQSxDQUFBQyxRQUFBLFVBUVVmLEtBQUFBLFNBQUFBLEdBbEJpQixPQW9CVGdCLEVBQUFBLFlBQWNDLFVBQXZCLFlBTlBDLFlBQUEsV0FkeUJDLFdBa0J0QkMsS0FBS3BCLHVCQUtWb0IsS0FBQUMsR0FIR0MsTUFBTSxTQUFBTCxHQUFBLE9BQVNELFFBQVFDLE1BQU1BLFVBV2hDTSxNQUFNQyxTQUFTQyxhQUFjLElBQUlMLEtBQUssU0FBU00sR0FIL0MsT0FBQUEsRUFBQUMsU0FLR1AsS0FBS1EscUJBSFJSLEtBQUFwQix1QkFDQXVCLEtBQU1DLEdBQ0pGLE1BQUEsU0FB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MkMsTUFlVCxTQUFTMEMsWUFBVCxHQUFTQSxJQUFUeEYsSUFHSSxJQUFJeUYsRUFBUyxRQUFUQSxFQUFTLE9BQWIzRixPQUFBQyxhQUFBLElBU0ZvQyxTQUFJdUQsZUFBVSxhQUFBbkMsYUFBZCxNQUhBLDJDQUdBa0MsRUFBYyxxQ0FhaEJ0RCxTQUFBd0QsaUJBQUEsbUJBQUEsV0FHRXpFLFFBQVEwRSxJQUFJLFVBRGR6RCIsImZpbGUiOiJyZXN0YXVyYW50X2luZm8uanMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgcmVzdGF1cmFudDtcbnZhciBtYXA7XG5cbnZhciBrZXkgPSBjb25maWcuZ29vZ2xlTWFwQXBpO1xuXG5mdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRzQWxsIChkYXRhKSB7XG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBmZXRjaFVuaXF1ZVJlc3RhdXJhbnQgKGRhdGEpIHtcbiAgY29uc3QgcmVzdGF1cmFudHMgPSBkYXRhO1xuICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuICBjb25zdCBpZCA9IGdldFBhcmFtZXRlckJ5TmFtZSgnaWQnKTtcbiAgaWYgKGlkKSB7XG4gICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5pZCA9PSBpZCk7XG4gICAgcmVzdGF1cmFudCA9IHJlc3VsdHNbMF07XG4gICAgcmV0dXJuIHJlc3RhdXJhbnQ7XG4gIH0gXG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICogZGVwcmVjYXRlZCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIChYSFIgZGVwZW5kZW50KSBpbiBmYXZvciBvZiBmZXRjaCBBUElcbiAqL1xuXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgXG4gIC8vIGltcGxlbWVudCBJbmRleGVkREIgd2hlcmUgc2VydmljZSB3b3JrZXIgaXMgYXZhaWxhYmxlLiBFbHNlIHVzZSBmZXRjaCBBUEkuXG4gIGlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICAgIHZhciBkYlByb21pc2UgPSBpZGIub3BlbignbXdzU3RhZ2UyJywgMSwgZnVuY3Rpb24odXBncmFkZURiKSB7XG4gICAgICAgIC8vIHNldCB1cCBzd2l0Y2ggdG8gbWFuYWdlIHZlcnNpb24gY29udHJvbFxuICAgICAgICBzd2l0Y2godXBncmFkZURiLm9sZFZlcnNpb24pIHtcbiAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAvLyBzZXQgdXAgYSBrZXkgdGhhdCdzIHNlcGFyYXRlIHRvIHRoZSBkYXRhXG4gICAgICAgICAgICAgICAgdmFyIG13c0RhdGFTdG9yZSA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgnbXdzRGF0YScsIHtrZXlQYXRoOiAnaWQnfSk7XG4gICAgICAgIH1cbiAgICB9KTsgIFxuICAgIFxuICAgIC8vIFBVVCBEQVRBIElOVE8gREFUQUJBU0U6IGNyZWF0ZSBhIGZldGNoIGV2ZW50IHRvIHB1bGwgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyLiBzZWUgbWFpbi5qc1xuICBcbiAgICAvLyBQVUxMIERBVEEgT1VUIE9GIERBVEFCQVNFOiBnZXQgYWxsIFJlc3RhdXJhbnRzXG4gICAgZnVuY3Rpb24gZ2V0UmVzdGF1cmFudCAoKSB7XG4gICAgICBkYlByb21pc2UudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgICB2YXIgdHggPSBkYi50cmFuc2FjdGlvbignbXdzRGF0YScsICdyZWFkb25seScpO1xuICAgICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnbXdzRGF0YScpO1xuICAgICAgICByZXR1cm4gc3RvcmUuZ2V0QWxsKCk7XG4gICAgICB9KS50aGVuKGZldGNoVW5pcXVlUmVzdGF1cmFudClcbiAgICAgIC50aGVuKGZldGNoUmVzdGF1cmFudE1hcClcbiAgICAgIC5jYXRjaChlcnJvciA9PiBjb25zb2xlLmVycm9yKGVycm9yKSk7IFxuICAgIH1cbiAgICBcbiAgICAvLyBpZiB0aGVyZSdzIGEgc2VydmljZSB3b3JrZXIsIHB1bGwgdGhlIGRhdGEgb3V0IG9mIEluZGV4ZWREQlxuICAgIGdldFJlc3RhdXJhbnQoKTtcbiAgXG4gIH0gZWxzZSB7XG4gIFxuICAgIC8vIGZldGNoIGV2ZW50cyBmb3IgYnJvd3NlcnMgdGhhdCBkbyBub3QgaGF2ZSBzZXJ2aWNlIHdvcmtlcnNcbiAgICBcbiAgICAvLyByZXN0YXVyYW50c1xuICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCwge30pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSkudGhlbihmZXRjaFJlc3RhdXJhbnRzQWxsKVxuICAgIC50aGVuKGZldGNoVW5pcXVlUmVzdGF1cmFudClcbiAgICAudGhlbihmZXRjaFJlc3RhdXJhbnRNYXApXG4gICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTsgXG4gIFxuICB9XG4gIFxuICBmdW5jdGlvbiBmZXRjaFJlc3RhdXJhbnRNYXAgKHJlc3RhdXJhbnQpIHtcbiAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgICB6b29tOiAxNixcbiAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICBzY3JvbGx3aGVlbDogZmFsc2VcbiAgICB9KTtcbiAgICBmaWxsQnJlYWRjcnVtYigpO1xuICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XG4gIH1cbn1cblxuXG5cbi8qKlxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxuICogZGVwcmVjYXRlZCBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKCkgKFhIUiBkZXBlbmRlbnQpIGluIGZhdm9yIG9mIGZldGNoIEFQSVxuICovXG4vLyBpbXBsZW1lbnQgSW5kZXhlZERCIHdoZXJlIHNlcnZpY2Ugd29ya2VyIGlzIGF2YWlsYWJsZS4gRWxzZSB1c2UgZmV0Y2ggQVBJLlxuaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gIHZhciBkYlByb21pc2UgPSBpZGIub3BlbignbXdzU3RhZ2UyJywgMSwgZnVuY3Rpb24odXBncmFkZURiKSB7XG4gICAgICAvLyBzZXQgdXAgc3dpdGNoIHRvIG1hbmFnZSB2ZXJzaW9uIGNvbnRyb2xcbiAgICAgIHN3aXRjaCh1cGdyYWRlRGIub2xkVmVyc2lvbikge1xuICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgLy8gc2V0IHVwIGEga2V5IHRoYXQncyBzZXBhcmF0ZSB0byB0aGUgZGF0YVxuICAgICAgICAgICAgICB2YXIgbXdzRGF0YVN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdtd3NEYXRhJywge2tleVBhdGg6ICdpZCd9KTtcbiAgICAgIH1cbiAgfSk7ICBcbiAgXG4gIC8vIFBVVCBEQVRBIElOVE8gREFUQUJBU0U6IGNyZWF0ZSBhIGZldGNoIGV2ZW50IHRvIHB1bGwgdGhlIGRhdGEgZnJvbSB0aGUgc2VydmVyLiBzZWUgbWFpbi5qc1xuXG4gIC8vIFBVTEwgREFUQSBPVVQgT0YgREFUQUJBU0U6IGdldCBhbGwgUmVzdGF1cmFudHNcbiAgZnVuY3Rpb24gZ2V0UmVzdGF1cmFudCAoKSB7XG4gICAgZGJQcm9taXNlLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKCdtd3NEYXRhJywgJ3JlYWRvbmx5Jyk7XG4gICAgICB2YXIgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnbXdzRGF0YScpO1xuICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xuICAgIH0pLnRoZW4oZmV0Y2hVbmlxdWVSZXN0YXVyYW50KVxuICAgIC50aGVuKGZldGNoVW5pcXVlUmVzdEhUTUwpXG4gICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcbiAgfVxuICBcbiAgLy8gaWYgdGhlcmUncyBhIHNlcnZpY2Ugd29ya2VyLCBwdWxsIHRoZSBkYXRhIG91dCBvZiBJbmRleGVkREJcbiAgZ2V0UmVzdGF1cmFudCgpO1xuXG59IGVsc2Uge1xuXG4gIC8vIGZldGNoIGV2ZW50cyBmb3IgYnJvd3NlcnMgdGhhdCBkbyBub3QgaGF2ZSBzZXJ2aWNlIHdvcmtlcnNcbiAgXG4gIC8vIHJlc3RhdXJhbnRzXG4gIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTCwge30pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICB9KS50aGVuKGZldGNoUmVzdGF1cmFudHNBbGwpXG4gIC50aGVuKGZldGNoVW5pcXVlUmVzdGF1cmFudClcbiAgLnRoZW4oZmV0Y2hVbmlxdWVSZXN0SFRNTClcbiAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoZXJyb3IpKTtcblxufVxuXG5cbmZ1bmN0aW9uIGZldGNoVW5pcXVlUmVzdEhUTUwgKHJlc3RhdXJhbnQpIHtcbiAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcbiAgZmlsbFJlc3RhdXJhbnRIVE1MKCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXG4gKi9cbmNvbnN0IGZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsICdwcm9tb3Rpb25hbCBwaG90byBmb3IgJyArIHJlc3RhdXJhbnQubmFtZSk7XG5cbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcblxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xuICB9XG4gIC8vIGZpbGwgcmV2aWV3c1xuICBmaWxsUmV2aWV3c0hUTUwoKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xuICBmb3IgKGxldCBrZXkgaW4gb3BlcmF0aW5nSG91cnMpIHtcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXG4gICAgY29uc3QgZGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGQnKTtcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xuXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cbmNvbnN0IGZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xuICB9KTtcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHVsKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqIEVkaXQ6IGFzc2lnbiBjbGFzc2VzIHRvIGVhY2ggPHA+IGVsZW1lbnQgZm9yIHN0eWxpbmcuXG4gKi9cbmNvbnN0IGNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJyZXZpZXdMaXN0aW5nXCIpO1xuXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmV2aWV3Lm5hbWU7XG4gIG5hbWUuc2V0QXR0cmlidXRlKFwiY2xhc3NcIiwgXCJyZXZpZXdOYW1lXCIpO1xuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcblxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBkYXRlLmlubmVySFRNTCA9IHJldmlldy5kYXRlO1xuICBkYXRlLnNldEF0dHJpYnV0ZShcImNsYXNzXCIsIFwicmV2aWV3RGF0ZVwiKTtcbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gIHJhdGluZy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInJldmlld1JhdGluZ1wiKTtcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcblxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xuICBjb21tZW50cy5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBcInJldmlld0NvbW1lbnRzXCIpO1xuICBsaS5hcHBlbmRDaGlsZChjb21tZW50cyk7XG5cbiAgcmV0dXJuIGxpO1xufVxuXG4vKipcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XG4gKi9cbmNvbnN0IGZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGJyZWFkY3J1bWIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnJlYWRjcnVtYicpO1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIGxpLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmFtZTtcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XG59XG5cbi8qKlxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cbiAqL1xubGV0IGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcbiAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBbPyZdJHtuYW1lfSg9KFteJiNdKil8JnwjfCQpYCksXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgaWYgKCFyZXN1bHRzKVxuICAgIHJldHVybiBudWxsO1xuICBpZiAoIXJlc3VsdHNbMl0pXG4gICAgcmV0dXJuICcnO1xuICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csICcgJykpO1xufVxuXG4vKipcbiAqIGpRdWVyeSBmb3IgR29vZ2xlIEFQSVxuICogcmVmZXJlbmNlOiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9kZXJ6b3JuZ290dGVzLzNiNTdlZGMxZjk5NmRkZGNhYjI1XG4gKi9cblxuZnVuY3Rpb24gYWRkQXBpS2V5KCkge1xuXG4gIGlmIChrZXkgPT0gJycpIHtcbiAgICB2YXIgYXBpS2V5ID0gJyc7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGFwaUtleSA9ICdrZXk9JyArIGNvbmZpZy5nb29nbGVNYXBBcGkgKyAnJic7XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKCdrZXk6ICcgKyBrZXkpO1xuICAvL2NvbnNvbGUubG9nKCdhcGlLZXk6ICcgKyBhcGlLZXkpO1xuICBcbiAgdmFyIHBhdGhTdGFydCA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/JztcbiAgdmFyIHBhdGhFbmQgPSAnbGlicmFyaWVzPXBsYWNlcyZjYWxsYmFjaz1pbml0TWFwJztcbiAgXG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnb29nbGVBcGknKS5zZXRBdHRyaWJ1dGUoJ3NyYycsIHBhdGhTdGFydCArIGFwaUtleSArIHBhdGhFbmQpO1xufVxuXG4vKlxuJCggZG9jdW1lbnQgKS5yZWFkeShmdW5jdGlvbigpIHtcbiAgY29uc29sZS5sb2coIFwicmVhZHkhXCIgKTtcbiAgYWRkQXBpS2V5KCk7XG59KTtcbiovXG5cbi8vIHRvIGltcHJvdmUgYXVkaXQgc2NvcmUsIGRlcHJlY2F0ZSBqUXVlcnlcbi8vIG1ldGhvZCBjcmVkaXQ6IGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzIzMDQ5NDEvd2hhdC1pcy10aGUtbm9uLWpxdWVyeS1lcXVpdmFsZW50LW9mLWRvY3VtZW50LXJlYWR5XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xuICBjb25zb2xlLmxvZyhcInJlYWR5IVwiKTtcbiAgYWRkQXBpS2V5KCk7XG59KTtcblxuXG5cblxuIl19
